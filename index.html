<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Liquid Glass Ultimate - é›™å­—å…¸ + å®Œæ•´å¤šèªç³» + iPadOSæ¸¸æ¨™</title>

<style>
/* =========================================
   1. Design Tokens (CSS è®Šæ•¸ç³»çµ±)
   ========================================= */
:root {
  /* --- æ·ºè‰²æ¨¡å¼ (Light Mode) --- */
  --bg-gradient: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
  --text-primary: #2d3436;
  --text-secondary: #636e72;
  
  /* æ¶²æ…‹ç»ç’ƒ (Light) */
  --glass-bg: rgba(255, 255, 255, 0.65);
  --glass-border: rgba(255, 255, 255, 0.9);
  --glass-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
  --glass-blur: blur(20px) saturate(180%);
  
  /* æŒ‰éˆ•æµ®é›•æ•ˆæœ (Neumorphism Glass) */
  --btn-bg: rgba(255, 255, 255, 0.4);
  --btn-shadow-out: 0 8px 16px rgba(0,0,0,0.1);
  --btn-shadow-in: inset 0 2px 4px rgba(255,255,255,0.8), inset 0 -2px 4px rgba(0,0,0,0.05);
  --btn-text: #2d3436;

  /* å¼·èª¿è‰² */
  --accent-color: #007bff;
  --ring-track: rgba(0, 0, 0, 0.08); /* æ™‚é–“ç’°æœªå¡«æ»¿é¡è‰² */
  
  /* æ¸¸æ¨™ */
  --cursor-size: 60px;
}

[data-theme="dark"] {
  /* --- æ·±è‰²æ¨¡å¼ (Dark Mode) - å„ªåŒ–é–±è®€æ€§ --- */
  --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  --text-primary: #f1f5f9; /* äº®ç™½æ–‡å­— */
  --text-secondary: #cbd5e1; /* æ·ºç°æ–‡å­— */
  
  /* æ¶²æ…‹ç»ç’ƒ (Dark) - æ›´é€šé€ï¼Œæ¸›å°‘ç°éœ§æ„Ÿ */
  --glass-bg: rgba(20, 20, 30, 0.3); 
  --glass-border: rgba(255, 255, 255, 0.15);
  --glass-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
  
  /* æŒ‰éˆ•æµ®é›• (Dark) */
  --btn-bg: rgba(255, 255, 255, 0.05);
  --btn-shadow-out: 0 8px 16px rgba(0,0,0,0.5);
  --btn-shadow-in: inset 0 1px 2px rgba(255,255,255,0.2), inset 0 -2px 4px rgba(0,0,0,0.3);
  --btn-text: #ffffff;

  --accent-color: #38bdf8;
  --ring-track: rgba(255, 255, 255, 0.1); /* æ·±è‰²æ¨¡å¼è»Œé“ */
}

/* =========================================
   2. Global Styles
   ========================================= */
* { box-sizing: border-box; }
body {
  margin: 0; padding: 40px 20px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  background: var(--bg-gradient);
  color: var(--text-primary);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
  overflow-x: hidden;
  cursor: none; /* éš±è—åŸç”Ÿæ¸¸æ¨™ */
}

/* é€šç”¨ç»ç’ƒå¡ç‰‡ */
.glass-card {
  background: var(--glass-bg);
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border);
  box-shadow: var(--glass-shadow);
  border-radius: 24px;
  padding: 30px;
  transition: all 0.3s ease;
}

/* ä½ˆå±€å®¹å™¨ */
.container {
  display: grid;
  grid-template-columns: 1fr 380px;
  gap: 30px;
  width: 100%;
  max-width: 1100px;
  align-items: start;
}

/* =========================================
   3. Components
   ========================================= */

/* Header & Titles */
h1 { margin: 0 0 5px 0; font-weight: 700; letter-spacing: -0.5px; }
.subtitle { font-size: 0.9em; color: var(--text-secondary); margin-bottom: 20px; }
.warning-text { color: #ff6b6b; font-size: 0.85em; font-weight: 600; margin-bottom: 15px; }

/* Input Area - Liquid Feel */
#wordInput {
  width: 100%; min-height: 150px;
  padding: 20px;
  font-size: 18px; line-height: 1.6;
  border-radius: 20px;
  border: 1px solid var(--glass-border);
  background: rgba(255,255,255,0.05); /* å¾®é€ */
  color: var(--text-primary);
  outline: none;
  box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
  transition: 0.3s;
}
#wordInput:focus {
  background: rgba(255,255,255,0.1);
  box-shadow: inset 0 2px 5px rgba(0,0,0,0.05), 0 0 0 2px var(--accent-color);
}
#wordInput::placeholder { color: var(--text-secondary); opacity: 0.7; }

/* Buttons - æµ®é›•èˆ‡å½ˆè·³ (Liquid Emboss) */
.button-group { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px; }

.btn {
  position: relative;
  padding: 12px 28px;
  font-size: 16px; font-weight: 600;
  color: var(--btn-text);
  border: none;
  border-radius: 50px;
  background: var(--btn-bg);
  box-shadow: var(--btn-shadow-out), var(--btn-shadow-in);
  backdrop-filter: blur(5px);
  cursor: none; /* ä½¿ç”¨è‡ªè¨‚æ¸¸æ¨™ */
  transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
  overflow: hidden;
}

/* é»æ“Šèˆ‡æ‡¸åœæ•ˆæœ */
.btn:active {
  transform: scale(0.95);
  box-shadow: 0 2px 5px rgba(0,0,0,0.1), inset 0 2px 4px rgba(0,0,0,0.2);
}
/* ç£å¸æ•ˆæœç”± JS æ§åˆ¶ transform */

#allButton {
  width: 50px; height: 50px; padding: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: 20px; border-radius: 50%;
  background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); /* ç´«è‰²æ¼¸å±¤ */
  color: #fff;
  box-shadow: 0 8px 20px rgba(161, 140, 209, 0.4);
}

/* Right Column */
.info-card { display: flex; flex-direction: column; gap: 20px; }

/* Clock */
.clock-display {
  display: flex; justify-content: space-between; align-items: baseline;
  font-feature-settings: "tnum"; font-variant-numeric: tabular-nums;
}
.clock-time { font-size: 28px; font-weight: 800; color: var(--text-primary); }
.clock-lang { font-size: 14px; color: var(--text-secondary); font-weight: 600; }

/* Pomodoro Ring (é›™è‰²å‹•æ…‹) */
.pomo-wrapper {
  display: flex; flex-direction: column; align-items: center; gap: 15px;
}
.ring-container {
  position: relative; width: 220px; height: 220px;
}
.ring-svg {
  width: 100%; height: 100%; transform: rotate(-90deg);
}
/* è»Œé“ (æœªå¡«æ»¿éƒ¨åˆ†) */
.ring-track {
  fill: none;
  stroke: var(--ring-track);
  stroke-width: 12;
  transition: stroke 0.3s;
}
/* é€²åº¦æ¢ (å¡«æ»¿éƒ¨åˆ†) */
.ring-progress {
  fill: none;
  stroke: url(#gradientStroke); /* ä½¿ç”¨ SVG æ¼¸å±¤ */
  stroke-width: 12;
  stroke-linecap: round;
  stroke-dasharray: 628; /* 2 * PI * 100 */
  stroke-dashoffset: 628;
  transition: stroke-dashoffset 0.1s linear;
}
/* æ‹–æ›³æ‰‹æŠŠ */
.ring-handle {
  position: absolute; top: 50%; left: 50%;
  width: 24px; height: 24px;
  background: #fff;
  border-radius: 50%;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
  cursor: none; /* ä½¿ç”¨è‡ªè¨‚æ¸¸æ¨™ */
  transform: translate(-50%, -50%);
  pointer-events: none; /* è®“ JS è¨ˆç®—ä½ç½® */
}
/* äº’å‹•å€åŸŸ (é€æ˜è“‹åœ¨ä¸Šé¢æ–¹ä¾¿æ‹–æ›³) */
.ring-overlay {
  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  cursor: none; z-index: 10;
}

.time-display {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}
.time-big { font-size: 32px; font-weight: 800; color: var(--text-primary); }
.time-small { font-size: 14px; color: var(--text-secondary); margin-top: 4px; }

/* èªè¨€é¸å–® (Floating) */
#langFab {
  position: fixed; bottom: 30px; right: 30px;
  width: 60px; height: 60px;
  border-radius: 50%;
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  box-shadow: var(--glass-shadow);
  display: flex; align-items: center; justify-content: center;
  font-size: 24px; cursor: none; z-index: 100;
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
#langFab:hover { transform: scale(1.1) rotate(10deg); }

#langMenu {
  position: fixed; bottom: 100px; right: 30px;
  width: 200px;
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
  padding: 10px;
  display: none; flex-direction: column; gap: 5px;
  box-shadow: var(--glass-shadow);
  z-index: 99;
  transform-origin: bottom right;
  animation: popUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes popUp { from { opacity:0; transform: scale(0.8) translateY(20px); } to { opacity:1; transform: scale(1) translateY(0); } }

.lang-option {
  padding: 12px; border-radius: 10px;
  cursor: none; text-align: center; font-weight: 600;
  color: var(--text-primary);
  transition: background 0.2s;
}
.lang-option:hover { background: rgba(255,255,255,0.15); }

/* =========================================
   4. Custom Cursor (iPadOS Style)
   ========================================= */
#cursor {
  position: fixed; top: 0; left: 0;
  width: var(--cursor-size); height: var(--cursor-size);
  border-radius: 50%;
  pointer-events: none; z-index: 9999;
  transform: translate(-50%, -50%);
  /* é€æ˜åº¦æ¥µé«˜ï¼Œç„¡é»‘é» */
  background: rgba(150, 150, 150, 0.1); 
  backdrop-filter: blur(2px); /* è¼•å¾®æ¨¡ç³ŠèƒŒæ™¯ */
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: width 0.3s cubic-bezier(0.25, 1, 0.5, 1), 
              height 0.3s cubic-bezier(0.25, 1, 0.5, 1),
              background 0.3s, border-radius 0.3s;
  will-change: transform, width, height;
}

/* ç‹€æ…‹ï¼šå¸é™„æŒ‰éˆ• (Morphing) */
body.hovering-btn #cursor {
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.0); /* å¸é™„æ™‚é‚Šæ¡†æ¶ˆå¤± */
  backdrop-filter: none;
}

/* Responsive */
@media (max-width: 900px) {
  .container { grid-template-columns: 1fr; }
  #cursor { display: none; } /* æ‰‹æ©Ÿéš±è—è‡ªè¨‚æ¸¸æ¨™ */
  body { cursor: auto; }
  .btn, .lang-option, #langFab { cursor: pointer; }
}
</style>
</head>
<body data-theme="light">

<div id="cursor"></div>

<div id="langFab">ğŸŒ</div>
<div id="langMenu">
  <div class="lang-option" data-lang="zh-TW">ç¹é«”ä¸­æ–‡</div>
  <div class="lang-option" data-lang="en">English</div>
  <div class="lang-option" data-lang="ja">æ—¥æœ¬èª</div>
  <div class="lang-option" data-lang="ko">í•œêµ­ì–´</div>
  <div class="lang-option" data-lang="zh-CN">ç®€ä½“ä¸­æ–‡</div>
  <div class="lang-option" data-lang="fr">FranÃ§ais</div>
</div>

<div class="container">
  
  <div class="glass-card">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div>
        <h1 data-i18n="title">ğŸ“š é›™å­—å…¸æ‰¹æ¬¡æŸ¥è©¢</h1>
        <div class="subtitle" data-i18n="subtitle">è¼¸å…¥å–®å­—ï¼Œä¸€éµé–‹å•Ÿæ‰€æœ‰è§£é‡‹</div>
      </div>
      <button class="btn" id="themeBtn" style="padding:10px 15px; border-radius:50%;">ğŸŒ™</button>
    </div>

    <div class="warning-text" data-i18n="warning">âš ï¸ è‹¥æŒ‰éˆ•ç„¡åæ‡‰ï¼Œè«‹å˜—è©¦ã€Œç¡¬é‡æ–°æ•´ç†ã€(Ctrl/Cmd + Shift + R)</div>

    <textarea id="wordInput" data-placeholder="placeholder"></textarea>

    <div class="button-group">
      <button class="btn" onclick="searchDict(0)" data-i18n="btnCambridge">åŠæ©‹è©å…¸</button>
      <button class="btn" onclick="searchDict(1)" data-i18n="btnDreye">è­¯å…¸é€š</button>
      <button class="btn" id="allButton" onclick="searchAll()" title="Open All">ğŸŸ£</button>
    </div>

    <div class="subtitle" style="margin-top:20px; font-size:0.85em;" data-i18n="tip">
      ğŸ’¡ æç¤ºï¼šæ”¯æ´å¤šè¡Œè¼¸å…¥ã€‚ç´«è‰²æŒ‰éˆ•å¯åŒæ™‚é–‹å•Ÿå…©æœ¬å­—å…¸ã€‚
    </div>
  </div>

  <div class="info-card">
    
    <div class="glass-card" style="padding: 20px;">
      <div class="clock-display">
        <div class="clock-time" id="clock">00:00:00</div>
        <div class="clock-lang" id="langDisplay">ZH-TW</div>
      </div>
    </div>

    <div class="glass-card">
      <div class="pomo-wrapper">
        <h3 style="margin:0;" data-i18n="timerTitle">å°ˆæ³¨ç•ªèŒ„é˜</h3>
        
        <div class="ring-container">
          <svg class="ring-svg" viewBox="0 0 220 220">
            <defs>
              <linearGradient id="gradientStroke" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#4facfe" />
                <stop offset="100%" stop-color="#00f2fe" />
              </linearGradient>
            </defs>
            <circle class="ring-track" cx="110" cy="110" r="100"></circle>
            <circle class="ring-progress" id="ringProgress" cx="110" cy="110" r="100"></circle>
          </svg>
          <div class="ring-overlay" id="ringOverlay"></div>
          <div class="ring-handle" id="ringHandle"></div>
          
          <div class="time-display">
            <div class="time-big" id="timeLeft">30:00</div>
            <div class="time-small" data-i18n="dragTip">æ‹–æ›³èª¿æ•´</div>
          </div>
        </div>

        <div class="button-group" style="justify-content:center; margin-top:0;">
          <button class="btn" id="pomoAction" data-i18n="start">é–‹å§‹</button>
          <button class="btn" onclick="resetTimer()" data-i18n="reset">é‡ç½®</button>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
// ==========================================
// 1. Dictionary & Theme Logic
// ==========================================
const DICT_URLS = [
  "https://dictionary.cambridge.org/zht/%E8%A9%9E%E5%85%B8/%E8%8B%B1%E8%AA%9E-%E6%BC%A2%E8%AA%9E-%E7%B9%81%E9%AB%94/",
  "https://yun.dreye.com/dict_new/dict.php?w="
];

function searchDict(index) {
  const input = document.getElementById('wordInput').value.trim();
  if(!input) return;
  const list = input.split('\n').map(w => w.trim()).filter(w => w);
  
  list.forEach((w, i) => {
    setTimeout(() => {
      let url = "";
      if(index === 0) url = DICT_URLS[0] + w.toLowerCase().replace(/\s/g, '-');
      else url = DICT_URLS[1] + w.replace(/\s/g, '+') + "&hidden_codepage=01";
      window.open(url, '_blank');
    }, i * 300);
  });
}

function searchAll() {
  const input = document.getElementById('wordInput').value.trim();
  if(!input) return;
  // Chain calls: Cambridge first, then Dr.eye slightly later
  searchDict(0);
  setTimeout(() => searchDict(1), 150);
}

// Theme Toggle
const themeBtn = document.getElementById('themeBtn');
themeBtn.addEventListener('click', () => {
  const body = document.body;
  const isDark = body.getAttribute('data-theme') === 'dark';
  body.setAttribute('data-theme', isDark ? 'light' : 'dark');
  themeBtn.textContent = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
});

// Clock
setInterval(() => {
  const now = new Date();
  document.getElementById('clock').textContent = now.toLocaleTimeString('en-US', {hour12:false});
}, 1000);

// ==========================================
// 2. Localization System (Language Switcher)
// ==========================================
const STRINGS = {
  "zh-TW": {
    title: "ğŸ“š é›™å­—å…¸æ‰¹æ¬¡æŸ¥è©¢", subtitle: "è¼¸å…¥å–®å­—ï¼Œä¸€éµé–‹å•Ÿæ‰€æœ‰è§£é‡‹", warning: "âš ï¸ è‹¥æŒ‰éˆ•ç„¡åæ‡‰ï¼Œè«‹å˜—è©¦ã€Œç¡¬é‡æ–°æ•´ç†ã€(Ctrl/Cmd + Shift + R)",
    placeholder: "è«‹è¼¸å…¥å–®å­—ï¼Œä¸€è¡Œä¸€å€‹ã€‚\nä¾‹å¦‚ï¼š\nparadigm\nsubsume\ntacit",
    btnCambridge: "åŠæ©‹è©å…¸", btnDreye: "è­¯å…¸é€š", tip: "ğŸ’¡ æç¤ºï¼šæ”¯æ´å¤šè¡Œè¼¸å…¥ã€‚ç´«è‰²æŒ‰éˆ•å¯åŒæ™‚é–‹å•Ÿå…©æœ¬å­—å…¸ã€‚",
    timerTitle: "å°ˆæ³¨ç•ªèŒ„é˜", dragTip: "æ‹–æ›³èª¿æ•´", start: "é–‹å§‹", pause: "æš«åœ", reset: "é‡ç½®"
  },
  "en": {
    title: "ğŸ“š Dictionary Batch Search", subtitle: "Enter words, open tabs instantly", warning: "âš ï¸ If buttons fail, try Hard Refresh (Ctrl/Cmd + Shift + R)",
    placeholder: "Enter words, one per line.\nExample:\nparadigm\nsubsume\ntacit",
    btnCambridge: "Cambridge", btnDreye: "Dr.eye", tip: "ğŸ’¡ Tip: Multi-line supported. Purple button opens both.",
    timerTitle: "Focus Timer", dragTip: "Drag to set", start: "Start", pause: "Pause", reset: "Reset"
  },
  "ja": {
    title: "ğŸ“š è¾æ›¸ä¸€æ‹¬æ¤œç´¢", subtitle: "å˜èªã‚’å…¥åŠ›ã—ã¦ä¸€æ‹¬ã§é–‹ã", warning: "âš ï¸ åå¿œãŒãªã„å ´åˆã¯ã€ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰ã‚’è©¦ã—ã¦ãã ã•ã„",
    placeholder: "1è¡Œã«1å˜èªå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\nä¾‹ï¼š\nparadigm\nsubsume",
    btnCambridge: "ã‚±ãƒ³ãƒ–ãƒªãƒƒã‚¸", btnDreye: "Dr.eye", tip: "ğŸ’¡ ãƒ’ãƒ³ãƒˆï¼šè¤‡æ•°è¡Œå¯¾å¿œã€‚ç´«ã®ãƒœã‚¿ãƒ³ã§ä¸¡æ–¹é–‹ãã¾ã™ã€‚",
    timerTitle: "é›†ä¸­ã‚¿ã‚¤ãƒãƒ¼", dragTip: "ãƒ‰ãƒ©ãƒƒã‚°è¨­å®š", start: "é–‹å§‹", pause: "ä¸€æ™‚åœæ­¢", reset: "ãƒªã‚»ãƒƒãƒˆ"
  },
  "ko": {
    title: "ğŸ“š ì‚¬ì „ ì¼ê´„ ê²€ìƒ‰", subtitle: "ë‹¨ì–´ ì…ë ¥ í›„ í•œ ë²ˆì— ì—´ê¸°", warning: "âš ï¸ ë²„íŠ¼ì´ ë°˜ì‘í•˜ì§€ ì•Šìœ¼ë©´ ê°•ì œ ìƒˆë¡œê³ ì¹¨ í•˜ì„¸ìš”",
    placeholder: "í•œ ì¤„ì— í•œ ë‹¨ì–´ì”© ì…ë ¥í•˜ì„¸ìš”.\nì˜ˆ:\nparadigm\nsubsume",
    btnCambridge: "ìº ë¸Œë¦¬ì§€", btnDreye: "Dr.eye", tip: "ğŸ’¡ íŒ: ì—¬ëŸ¬ ì¤„ ì§€ì›. ë³´ë¼ìƒ‰ ë²„íŠ¼ì€ ë‘˜ ë‹¤ ì—½ë‹ˆë‹¤.",
    timerTitle: "ì§‘ì¤‘ íƒ€ì´ë¨¸", dragTip: "ë“œë˜ê·¸ ì„¤ì •", start: "ì‹œì‘", pause: "ì¼ì‹œì •ì§€", reset: "ì´ˆê¸°í™”"
  },
  "zh-CN": {
    title: "ğŸ“š åŒè¯å…¸æ‰¹é‡æŸ¥è¯¢", subtitle: "è¾“å…¥å•è¯ï¼Œä¸€é”®å¼€å¯æ‰€æœ‰è§£é‡Š", warning: "âš ï¸ è‹¥æŒ‰é’®æ— ååº”ï¼Œè¯·å°è¯•ã€Œç¡¬åˆ·æ–°ã€(Ctrl/Cmd + Shift + R)",
    placeholder: "è¯·è¾“å…¥å•è¯ï¼Œä¸€è¡Œä¸€ä¸ªã€‚\nä¾‹å¦‚ï¼š\nparadigm\nsubsume",
    btnCambridge: "å‰‘æ¡¥è¯å…¸", btnDreye: "è¯‘å…¸é€š", tip: "ğŸ’¡ æç¤ºï¼šæ”¯æŒå¤šè¡Œè¾“å…¥ã€‚ç´«è‰²æŒ‰é’®å¯åŒæ—¶å¼€å¯ä¸¤æœ¬å­—å…¸ã€‚",
    timerTitle: "ä¸“æ³¨ç•ªèŒ„é’Ÿ", dragTip: "æ‹–æ‹½è°ƒæ•´", start: "å¼€å§‹", pause: "æš‚åœ", reset: "é‡ç½®"
  },
  "fr": {
    title: "ğŸ“š Recherche Dico GroupÃ©e", subtitle: "Entrez des mots, ouvrez tout", warning: "âš ï¸ Si bloquÃ©, essayez Ctrl/Cmd + Shift + R",
    placeholder: "Un mot par ligne.\nExemple:\nparadigm\nsubsume",
    btnCambridge: "Cambridge", btnDreye: "Dr.eye", tip: "ğŸ’¡ Conseil: Multiligne supportÃ©. Le bouton violet ouvre tout.",
    timerTitle: "Minuteur Focus", dragTip: "Glisser rÃ©gler", start: "DÃ©marrer", pause: "Pause", reset: "RÃ©initialiser"
  }
};

const langMenu = document.getElementById('langMenu');
const langFab = document.getElementById('langFab');
const langDisplay = document.getElementById('langDisplay');

langFab.addEventListener('click', (e) => {
  e.stopPropagation();
  langMenu.style.display = langMenu.style.display === 'flex' ? 'none' : 'flex';
});

document.addEventListener('click', () => langMenu.style.display = 'none');

document.querySelectorAll('.lang-option').forEach(opt => {
  opt.addEventListener('click', () => {
    const lang = opt.getAttribute('data-lang');
    applyLanguage(lang);
  });
});

function applyLanguage(lang) {
  const texts = STRINGS[lang];
  document.getElementById('langDisplay').textContent = lang.toUpperCase();
  
  // Update standard text
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if(texts[key]) el.textContent = texts[key];
  });
  
  // Update Placeholder
  document.getElementById('wordInput').placeholder = texts.placeholder;
  
  // Update Button State Text (Start/Pause) logic needs check
  if(!timerRunning) {
    document.getElementById('pomoAction').textContent = texts.start;
  } else {
    document.getElementById('pomoAction').textContent = texts.pause;
  }
  
  // Dark mode text color update handled by CSS variables
}

// Initial Lang
applyLanguage('zh-TW');


// ==========================================
// 3. iPadOS Magnetic Cursor & Button Effect
// ==========================================
const cursor = document.getElementById('cursor');
let mouseX = 0, mouseY = 0;
let cursorX = 0, cursorY = 0;

document.addEventListener('mousemove', e => {
  mouseX = e.clientX;
  mouseY = e.clientY;
});

// Smooth Cursor Follow
function animateCursor() {
  const dist = 0.2; // Cursor lag factor
  cursorX += (mouseX - cursorX) * dist;
  cursorY += (mouseY - cursorY) * dist;
  
  cursor.style.left = `${cursorX}px`;
  cursor.style.top = `${cursorY}px`;
  
  requestAnimationFrame(animateCursor);
}
animateCursor();

// Magnetic Button Effect
const btns = document.querySelectorAll('.btn, .lang-option, #langFab');

btns.forEach(btn => {
  btn.addEventListener('mousemove', (e) => {
    const rect = btn.getBoundingClientRect();
    const x = e.clientX - rect.left - rect.width / 2;
    const y = e.clientY - rect.top - rect.height / 2;
    
    // Magnetic pull strength
    btn.style.transform = `translate(${x * 0.3}px, ${y * 0.3}px) scale(1.05)`;
    
    // Cursor Morphing
    cursor.style.width = `${rect.width}px`;
    cursor.style.height = `${rect.height}px`;
    cursor.style.borderRadius = getComputedStyle(btn).borderRadius;
    document.body.classList.add('hovering-btn');
  });

  btn.addEventListener('mouseleave', () => {
    btn.style.transform = 'translate(0, 0) scale(1)';
    
    // Reset Cursor
    cursor.style.width = 'var(--cursor-size)';
    cursor.style.height = 'var(--cursor-size)';
    cursor.style.borderRadius = '50%';
    document.body.classList.remove('hovering-btn');
  });
});


// ==========================================
// 4. Interactive Pomodoro Ring
// ==========================================
const ringProgress = document.getElementById('ringProgress');
const ringOverlay = document.getElementById('ringOverlay');
const ringHandle = document.getElementById('ringHandle');
const timeDisplay = document.getElementById('timeLeft');
const pomoBtn = document.getElementById('pomoAction');

let totalTime = 1800; // seconds (30 min)
let timeLeft = totalTime;
let timerRunning = false;
let timerInterval = null;
let isDragging = false;

const RADIUS = 100; // SVG circle radius
const CENTER = 110; // SVG center
const CIRCUMFERENCE = 2 * Math.PI * RADIUS;

function updateRing(seconds) {
  const offset = CIRCUMFERENCE - (seconds / 10800) * CIRCUMFERENCE; // Max 3 hours (10800s)
  ringProgress.style.strokeDashoffset = offset;
  
  // Move Handle
  const angle = (seconds / 10800) * 360;
  const radians = (angle - 90) * (Math.PI / 180);
  const x = CENTER + RADIUS * Math.cos(radians);
  const y = CENTER + RADIUS * Math.sin(radians);
  
  // Scale Handle position from SVG space (220x220) to CSS container space (220x220)
  // Since they match, direct mapping works.
  ringHandle.style.left = `${x}px`;
  ringHandle.style.top = `${y}px`;
  
  // Text
  const m = Math.floor(seconds / 60).toString().padStart(2, '0');
  const s = (seconds % 60).toString().padStart(2, '0');
  timeDisplay.textContent = `${m}:${s}`;
}

// Drag Logic
function getAngle(e) {
  const rect = ringOverlay.getBoundingClientRect();
  const x = e.clientX - rect.left - rect.width/2;
  const y = e.clientY - rect.top - rect.height/2;
  // Atan2 returns -PI to PI. Adjust to start from top (0 deg)
  let angle = Math.atan2(y, x) * (180 / Math.PI) + 90;
  if(angle < 0) angle += 360;
  return angle;
}

ringOverlay.addEventListener('mousedown', () => isDragging = true);
document.addEventListener('mouseup', () => isDragging = false);
document.addEventListener('mousemove', (e) => {
  if(!isDragging) return;
  // Stop timer if dragging
  if(timerRunning) pauseTimer();
  
  const angle = getAngle(e);
  // Map angle (0-360) to seconds (0-10800)
  // Snap to nearest 10s
  let seconds = Math.round((angle / 360) * 10800 / 10) * 10;
  if(seconds <= 0) seconds = 10; 
  
  timeLeft = seconds;
  totalTime = seconds; // Set new baseline
  updateRing(timeLeft);
});

// Timer Logic
pomoBtn.addEventListener('click', () => {
  if(timerRunning) pauseTimer();
  else startTimer();
});

function startTimer() {
  timerRunning = true;
  const curLangData = STRINGS[document.getElementById('langDisplay').textContent.toLowerCase()] || STRINGS['zh-TW'];
  pomoBtn.textContent = curLangData.pause;
  
  timerInterval = setInterval(() => {
    if(timeLeft > 0) {
      timeLeft--;
      updateRing(timeLeft);
    } else {
      pauseTimer();
      alert("â° Time's up!");
    }
  }, 1000);
}

function pauseTimer() {
  timerRunning = false;
  clearInterval(timerInterval);
  const curLangData = STRINGS[document.getElementById('langDisplay').textContent.toLowerCase()] || STRINGS['zh-TW'];
  pomoBtn.textContent = curLangData.start;
}

function resetTimer() {
  pauseTimer();
  timeLeft = 1800; // Reset to default 30m or last set? Let's reset to 30m
  updateRing(timeLeft);
}

// Init Ring
updateRing(timeLeft);

</script>
</body>
</html>
